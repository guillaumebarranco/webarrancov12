<app-menu></app-menu>

<div class="musics-container">
  <h1>Musiques Ã©coutÃ©es ({{ allMusics().length }})</h1>

  @if(allMusics().length === 0) {
  <div class="empty-state">
    <p class="empty-message">Vous n'avez aucune musique dans votre collection.</p>
    <p class="empty-subtitle">
      Commencez dÃ¨s maintenant Ã  crÃ©er votre playlist personnelle !
    </p>
    <button class="btn btn-primary" [routerLink]="getSelectMusicsRoute()">
      SÃ©lectionner mes musiques
    </button>
  </div>
  }

  <div class="musics-header">
    <app-stats-display
      [stats]="stats()"
      [count]="allMusics().length"
      countLabel="musiques"
    >
    </app-stats-display>

    <div class="controls">
      <button class="view-toggle" (click)="toggleViewMode()">
        @if (viewMode() === 'albums') {
          <span>ðŸŽµ Toutes les chansons</span>
        } @else {
          <span>ðŸ’¿ Vue par albums</span>
        }
      </button>

      <app-sort-dropdown
        [sortOptions]="sortOptions"
        [selectedSort]="selectedSort()"
        (sortChange)="onSortChange($event)"
      >
      </app-sort-dropdown>
    </div>
  </div>

  @if (viewMode() === 'albums') {
    <!-- Vue par Albums -->
    @if (completeAlbums().length > 0) {
      <div class="section">
        <h2 class="section-title">ðŸ’¿ Albums complets ({{ completeAlbums().length }})</h2>
        <div class="albums-grid">
          @for (album of completeAlbums(); track `${album.name}-${album.artist}`) {
            <div class="album-card">
              <div class="album-cover">
                <img [src]="album.coverUrl" [alt]="album.name" />
                <div class="album-overlay">
                  <span class="album-count">{{ album.musics.length }} titres</span>
                </div>
              </div>
              <div class="album-info">
                <h3 class="album-name">{{ album.name }}</h3>
                <p class="album-artist">{{ album.artist }}</p>
                <p class="album-duration">{{ formatAlbumDuration(album.totalDuration) }}</p>
              </div>
            </div>
          }
        </div>
      </div>
    }

    @if (sortedStandaloneMusics().length > 0) {
      <div class="section">
        <h2 class="section-title">ðŸŽµ Musiques ({{ sortedStandaloneMusics().length }})</h2>
        <div class="musics">
          @for (music of sortedStandaloneMusics(); track `${music.title}-${music.artist}`) {
            <div class="music-card">
              <app-music [music]="music"></app-music>
            </div>
          }
        </div>
      </div>
    }
  } @else {
    <!-- Vue toutes les chansons -->
    <div class="musics">
      @for (music of sortedMusics(); track `${music.title}-${music.artist}`) {
        <div class="music-card">
          <app-music [music]="music"></app-music>
        </div>
      }
    </div>
  }
</div>

